# 蝴蝶兰叶片图像分类实验实施方案

## 1. 项目结构与环境准备

### 1.1 现有项目结构分析

* 基于 Lightning + Hydra 框架

* 数据目录：`data/my_dataset/` 包含多个蝴蝶兰品种子文件夹

* 现有 `MyDatasetDataModule` 类需要实现

* 现有模型仅支持 MNIST，需要扩展

### 1.2 环境准备

* 安装必要依赖：`torchvision`, `timm`, `scikit-learn`, `matplotlib`, `grad-cam`

* 确保 CUDA 环境可用（如果使用 GPU 训练）

## 2. 数据处理模块实现

### 2.1 实现 `MyDatasetDataModule`

* 使用 `torchvision.datasets.ImageFolder` 加载数据集

* 实现数据划分：训练集、验证集、测试集（7:1.5:1.5）

* 实现数据增强：随机裁剪、翻转、旋转等

* 实现标准化和批次处理

### 2.2 配置数据模块

* 创建 `configs/data/my_dataset.yaml` 配置文件

* 设置批次大小、数据增强参数等

## 3. 模型组件实现

### 3.1 模型架构支持

实现支持以下模型架构的组件：

* ResNet50

* InceptionV3

* ViT-Base/16

* Bilinear CNN

* MAE + ViT

* DINO + ViT

* iBOT + ViT

### 3.2 模型配置

* 为每个模型创建配置文件：`configs/model/{model_name}.yaml`

* 设置预训练权重加载、分类头调整等参数

## 4. 训练模块扩展

### 4.1 扩展 `LitModule`

* 实现多分类支持（动态类别数量）

* 添加评估指标：Precision、Recall、F1-score

### 4.2 训练配置

* 创建实验配置文件：`configs/experiment/orchid_classification.yaml`

* 设置优化器、学习率调度器、训练轮数等

## 5. 可视化功能实现

### 5.1 t-SNE 特征降维

* 实现特征提取功能

* 使用 `sklearn.manifold.TSNE` 进行降维

* 可视化不同品种在特征空间的分布

### 5.2 Grad-CAM 热力图

* 使用 `grad-cam` 库实现热力图生成

* 可视化模型关注的叶片关键区域

* 保存热力图结果

## 6. 实验执行计划

### 6.1 单模型训练

* 为每个模型执行训练：`python src/train.py experiment=orchid_classification model={model_name}`

* 记录训练日志、验证指标

* 保存最佳模型权重

### 6.2 模型评估

* 执行测试集评估：`python src/eval.py ckpt_path={checkpoint_path}`

* 计算并记录所有评估指标

* 生成混淆矩阵

### 6.3 可视化生成

* 运行可视化脚本：`python src/visualize.py ckpt_path={checkpoint_path}`

* 生成 t-SNE 可视化和 Grad-CAM 热力图

* 保存可视化结果

## 7. 实验结果记录与整理

### 7.1 结果记录

* 使用 Hydra 日志系统记录实验参数和结果

* 保存评估指标到 CSV 文件

* 保存可视化图像到指定目录

### 7.2 结果整理

* 对比不同模型的性能

* 分析特征空间分布

* 分析模型关注区域

* 生成实验报告

## 8. 预期成果

### 8.1 模型性能对比

* 7 种模型在蝴蝶兰叶片分类任务上的性能对比

* 准确率、精确率、召回率、F1-score 指标

### 8.2 可视化结果

* 每个模型的 t-SNE 特征降维可视化

* 代表性样本的 Grad-CAM 热力图

### 8.3 实验报告

* 完整的实验过程记录

* 可复现的实验配置

* 符合学术规范的结果分析

## 9. 时间安排

1. 数据处理模块实现：1 天
2. 模型组件实现：2 天
3. 训练模块扩展：1 天
4. 可视化功能实现：1 天
5. 单模型训练与评估：7 天（每天训练 1 个模型）
6. 结果整理与报告：2 天

## 10. 注意事项

* 确保实验结果可复现（固定随机种子）

* 监控训练过程，及时调整超参数

* 保存所有实验日志和模型权重

* 确保可视化结果清晰易懂

* 遵循学术论文规范整理结果

## 11. 技术栈

* **框架**：PyTorch Lightning + Hydra

* **模型库**：torchvision, timm

* **评估指标**：torchmetrics, scikit-learn

* **可视化**：matplotlib, grad-cam, scikit-learn

* **日志**：Hydra 日志系统

## 12. 预期输出

* 完整的实验代码

* 7 个模型的训练日志和权重

* 详细的评估指标报告

* t-SNE 特征可视化图像

* Grad-CAM 热力图

* 符合学术规范的实验报告

